(this["webpackJsonpbike-tracker"]=this["webpackJsonpbike-tracker"]||[]).push([[0],{279:function(e,t,n){e.exports=n(470)},284:function(e,t,n){},307:function(e,t){},309:function(e,t){},469:function(e,t,n){},470:function(e,t,n){"use strict";n.r(t);var r,a,i,c,o,u,s=n(0),l=n.n(s),m=n(28),f=n.n(m),p=(n(284),n(41)),d=n(484),b=n(487),h=n(242),g=n(486),y=n(471),v=n(42),k=n.n(v),O=n(74),w=n(167),T=n(266),E=n(481),j=n(64),I=n(244),x=n(76),S=n(44),C=(n(290),n(245)),F=n(112),B=n(8),M=n(485),z=n(246),P=n.n(z),J=n(247),N=n.n(J),A=n(248),D=n.n(A),H=function(e,t,n,r){return 0===n?t:(e*n+t*r)/(n+r)},V=function(e){return{latitude:+e.latitude,longitude:+e.longitude,heartrate:+e.heartrate,elevation:+e.elevation,timestamp:D()(e.timestamp).valueOf()}},W=function(){var e=Object(O.a)(k.a.mark((function e(t,n,r){var a,i,c,o,u;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new N.a.Parser,e.next=3,new Promise((function(e,n){return a.parseString(t,(function(t,r){t?n(t):e(P()(r.gpx.trk).map(V))}))}));case 3:return i=e.sent,c=Math.min.apply(Math,Object(F.a)(i.map((function(e){return e.timestamp})))),o=Math.max.apply(Math,Object(F.a)(i.map((function(e){return e.timestamp})))),u=i.map((function(e){return Object(C.a)({},e,{relativeTime:e.timestamp-c})})),e.abrupt("return",{name:r,id:n,positions:u,startTime:c,endTime:o,timeOffset:0});case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),G=new(r=function(){function e(){var t=this;if(Object(I.a)(this,e),Object(j.a)(this,"tracksById",a,this),Object(j.a)(this,"currentTime",i,this),Object(j.a)(this,"autoIncrement",c,this),Object(j.a)(this,"addTrack",o,this),Object(j.a)(this,"removeTrack",u,this),this.getCurrentPoint=function(e){var n=t.tracks.find((function(t){return t.id===e}));if(!n)throw new Error("id not found");var r=n.positions.filter((function(e){return e.relativeTime+n.timeOffset<=t.currentTime})).reverse()[0],a=n.positions.filter((function(e){return e.relativeTime+n.timeOffset>=t.currentTime}))[0];return r&&a?[H(r.latitude,a.latitude,Math.abs(a.relativeTime+n.timeOffset-t.currentTime),Math.abs(r.relativeTime+n.timeOffset-t.currentTime)),H(r.longitude,a.longitude,Math.abs(a.relativeTime+n.timeOffset-t.currentTime),Math.abs(r.relativeTime+n.timeOffset-t.currentTime))]:null},this.persist=function(){var e=JSON.stringify(G.tracksById),t=JSON.stringify(G.currentTime);window.localStorage.setItem("tracksById",e),window.localStorage.setItem("currentTime",t),window.localStorage.setItem("storeVersion",JSON.stringify(2))},this.getTrackColor=function(e){return function(e,t){var n=["#CC0000","#FF8000","#FFFF00","#00FF00","#0080FF","#7F00FF","#FF00FF","#663300"];return t<n.length?n[t]:function(e){for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);for(var r="#",a=0;a<3;a++){r+=("00"+(t>>8*a&255).toString(16)).substr(-2)}return r}(e)}(e,(t.tracks.map((function(e,t){return[e.id,t]})).find((function(t){return t[0]===e}))||["",1/0])[1])},2===JSON.parse(window.localStorage.getItem("storeVersion")||"-1")){console.log("restoring");var n=window.localStorage.getItem("tracksById");n&&(this.tracksById=JSON.parse(n));var r=window.localStorage.getItem("currentTime");r&&(this.currentTime=JSON.parse(r))}}return Object(x.a)(e,[{key:"tracks",get:function(){return Object.values(this.tracksById)}}]),Object(x.a)(e,[{key:"maxTime",get:function(){return Math.max.apply(Math,Object(F.a)(this.tracks.map((function(e){return e.endTime-e.startTime}))))}}]),e}(),a=Object(S.a)(r.prototype,"tracksById",[B.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),i=Object(S.a)(r.prototype,"currentTime",[B.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c=Object(S.a)(r.prototype,"autoIncrement",[B.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(S.a)(r.prototype,"tracks",[B.g],Object.getOwnPropertyDescriptor(r.prototype,"tracks"),r.prototype),Object(S.a)(r.prototype,"maxTime",[B.g],Object.getOwnPropertyDescriptor(r.prototype,"maxTime"),r.prototype),o=Object(S.a)(r.prototype,"addTrack",[B.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t=Object(O.a)(k.a.mark((function t(n,r){var a;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object(M.a)(),t.next=3,W(n,a,r);case 3:e.tracksById[a]=t.sent;case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}}),u=Object(S.a)(r.prototype,"removeTrack",[B.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){delete e.tracksById[t]}}}),r);window.persist=G.persist,Object(B.o)(G.tracksById,(function(){G.persist()}));setInterval((function(){G.autoIncrement&&(G.currentTime=Math.min(G.currentTime+1e3,G.maxTime))}),1e3/60);var R=G,$=Object(p.a)((function(){var e=Object(s.useState)(!1),t=Object(w.a)(e,2),n=t[0],r=t[1],a=Object(T.a)(),i=a.acceptedFiles,c=a.getRootProps,o=a.getInputProps,u=Object(s.useState)(new Set),m=Object(w.a)(u,2),f=m[0],p=m[1],d=function(e){return p((function(t){var n=new Set(t);return n.add(e),n}))};return Object(s.useEffect)((function(){i.forEach(d)}),[n]),l.a.createElement(E.a,{trigger:l.a.createElement(y.a,{primary:!0,content:"Add Tracks",onClick:function(){return r(!0)}}),open:n,onClose:function(){return r(!1)}},l.a.createElement(E.a.Header,null,"Add Track"),l.a.createElement(E.a.Content,null,i.filter((function(e){return!f.has(e)})).map((function(e){return l.a.createElement(g.a,{key:e.name,style:{display:"flex",justifyContent:"space-between"}},e.name,l.a.createElement(y.a,{negative:!0,icon:"trash",onClick:function(){return d(e)}}))})),l.a.createElement("div",c(),l.a.createElement(g.a,null,l.a.createElement("input",o()),l.a.createElement("p",null,"+ Drag 'n' drop some files here, or click to select files +")))),l.a.createElement(E.a.Actions,null,l.a.createElement(y.a,{primary:!0,content:"Add selected tracks",onClick:function(){i.filter((function(e){return!f.has(e)})).forEach(function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=R,e.next=3,t.text();case 3:return e.t1=e.sent,e.t2=t.name.split(".")[0],e.next=7,e.t0.addTrack.call(e.t0,e.t1,e.t2);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r(!1)}})))})),q=(n(469),n(478)),K=n(479),L=Object(p.a)((function(e){var t=e.track,n=(e.index,R.getTrackColor(t.id)),r=R.getCurrentPoint(t.id);return l.a.createElement(l.a.Fragment,null,l.a.createElement(q.a,{color:n,positions:t.positions.map((function(e){return[e.latitude,e.longitude]}))}),r&&l.a.createElement(K.a,{center:r,color:n,radius:10}))})),Q=n(483),U=n(480),X=n(36),Y=Object(p.a)((function(e){var t=e.track,n=R.getTrackColor(t.id);return l.a.createElement(g.a,{style:{borderTop:"2px solid ".concat(n),display:"flex",justifyContent:"flex-end"}},l.a.createElement(Q.a,{horizontal:!0},l.a.createElement(Q.a.Item,null,l.a.createElement("p",null,t.name)),l.a.createElement(Q.a.Item,null,l.a.createElement(U.a,{label:"Offset in seconds",labelPosition:"left corner",type:"number",val:"".concat(R.tracksById[t.id].timeOffset/1e3),onChange:function(e){R.tracksById[t.id].timeOffset=1e3*+e.target.value}})),l.a.createElement(Q.a.Item,null,l.a.createElement(y.a,{icon:!0,negative:!0,onClick:function(){return R.removeTrack(t.id)}},l.a.createElement(X.a,{name:"trash"})))))}));var Z=Object(p.a)((function(){var e=~~(R.currentTime/1e3),t=~~(e/60);e%=60;var n=~~(t/60);return t%=60,l.a.createElement("div",{className:"App",style:{display:"flex",justifyContent:"center",alignItems:"center"}},l.a.createElement("div",{style:{position:"absolute",top:0,right:0,zIndex:1e3,maxHeight:"calc(100vw - 100px)",overflow:"auto"}},l.a.createElement(g.a,null,R.tracks.map((function(e){return l.a.createElement(Y,{key:e.id,track:e})})),l.a.createElement($,null))),R.tracks.length&&l.a.createElement("div",{style:{position:"absolute",bottom:0,right:0,left:0,zIndex:1e3}},l.a.createElement(g.a,{style:{display:"flex",alignItems:"center"}},l.a.createElement(y.a,{onClick:function(){R.autoIncrement=!R.autoIncrement},basic:!0},R.autoIncrement?"Stop":"Play"),l.a.createElement("span",{style:{width:"100px"}},n,":",t,":",e),l.a.createElement("div",{style:{flexGrow:1}},l.a.createElement(h.Slider,{value:R.currentTime,settings:{min:0,max:R.maxTime,step:1,onChange:function(e){Math.abs(e-R.currentTime)>6e4&&(R.autoIncrement=!1),R.currentTime=e}}})))),l.a.createElement(d.a,{center:[49.75618698634207,13.303053053095937],zoom:15},l.a.createElement(b.a,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),R.tracks.map((function(e,t){return l.a.createElement(L,{track:e,index:t})}))))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));f.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(Z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[279,1,2]]]);
//# sourceMappingURL=main.f82bf5d3.chunk.js.map