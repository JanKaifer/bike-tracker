(this["webpackJsonpbike-tracker"]=this["webpackJsonpbike-tracker"]||[]).push([[0],{284:function(e,t,n){e.exports=n(475)},289:function(e,t,n){},312:function(e,t){},314:function(e,t){},474:function(e,t,n){},475:function(e,t,n){"use strict";n.r(t);var a,r,i,c,o,l,u=n(1),s=n.n(u),m=n(27),f=n.n(m),p=(n(289),n(43)),d=n(489),h=n(493),b=n(247),g=n(491),E=n(476),v=n(44),y=n.n(v),k=n(76),O=n(37),w=n(271),j=n(486),T=n(66),I=n(249),x=n(78),M=n(46),C=(n(295),n(250)),S=n(118),F=n(9),z=n(490),B=n(251),P=n.n(B),N=n(252),A=n.n(N),J=n(253),D=n.n(J),W=function(e){return{latitude:+e.latitude,longitude:+e.longitude,heartrate:+e.heartrate,elevation:+e.elevation,timestamp:D()(e.timestamp).valueOf()}},q=function(e){return e*Math.PI/180},H=function(e){return[e.latitude,e.latitude]},V=function(e,t){var n=function(e,t){var n=Object(O.a)(e,2),a=n[0],r=n[1],i=Object(O.a)(t,2),c=i[0],o=i[1],l=q(a),u=q(c),s=q(c-a),m=q(o-r),f=Math.sin(s/2)*Math.sin(s/2)+Math.cos(l)*Math.cos(u)*Math.sin(m/2)*Math.sin(m/2);return 6371e3*(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)))}(H(e),H(t)),a=(t.timestamp-e.timestamp)/1e3;return a>0?n/a:void 0},G=function(){var e=Object(k.a)(y.a.mark((function e(t,n,a){var r,i,c,o,l,u,s,m;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new A.a.Parser,e.next=3,new Promise((function(e,n){return r.parseString(t,(function(t,a){t?n(t):e([P()(a.gpx.trk).map(W),a.gpx.trk])}))}));case 3:return i=e.sent,c=Object(O.a)(i,2),o=c[0],l=c[1],u=Math.min.apply(Math,Object(S.a)(o.map((function(e){return e.timestamp})))),s=Math.max.apply(Math,Object(S.a)(o.map((function(e){return e.timestamp})))),m=o.map((function(e,t){return Object(C.a)({},e,{relativeTime:e.timestamp-u,speed:V(o[t-1]||e,o[t+1]||e)})})),console.log(m),e.abrupt("return",{name:l.name||a,id:n,positions:m,startTime:u,endTime:s,timeOffset:0});case 12:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),R=new(a=function(){function e(){var t=this;if(Object(I.a)(this,e),Object(T.a)(this,"tracksById",r,this),Object(T.a)(this,"currentTime",i,this),Object(T.a)(this,"autoIncrement",c,this),Object(T.a)(this,"addTrack",o,this),Object(T.a)(this,"removeTrack",l,this),this.getCurrentPoint=function(e){var n=t.tracks.find((function(t){return t.id===e}));if(!n)throw new Error("id not found");var a=n.positions.filter((function(e){return e.relativeTime+n.timeOffset<=t.currentTime})).reverse()[0],r=n.positions.filter((function(e){return e.relativeTime+n.timeOffset>=t.currentTime}))[0];if(!a||!r)return null;var i=function(e){return i=a[e],c=r[e],function(e,t,n,a){return 0===n?t:(e*n+t*a)/(n+a)}(i,c,Math.abs(r.relativeTime+n.timeOffset-t.currentTime),Math.abs(a.relativeTime+n.timeOffset-t.currentTime));var i,c};return{elevation:i("elevation"),latitude:i("latitude"),longitude:i("longitude"),heartrate:i("heartrate"),relativeTime:i("relativeTime"),timestamp:i("timestamp"),speed:i("speed")}},this.persist=function(){var e=JSON.stringify(R.tracksById),t=JSON.stringify(R.currentTime);window.localStorage.setItem("tracksById",e),window.localStorage.setItem("currentTime",t),window.localStorage.setItem("storeVersion",JSON.stringify(2))},this.getTrackColor=function(e){return function(e,t){var n=["#CC0000","#FF8000","#FFFF00","#00FF00","#0080FF","#7F00FF","#FF00FF","#663300"];return t<n.length?n[t]:function(e){for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);for(var a="#",r=0;r<3;r++){a+=("00"+(t>>8*r&255).toString(16)).substr(-2)}return a}(e)}(e,(t.tracks.map((function(e,t){return[e.id,t]})).find((function(t){return t[0]===e}))||["",1/0])[1])},2===JSON.parse(window.localStorage.getItem("storeVersion")||"-1")){var n=window.localStorage.getItem("tracksById");n&&(this.tracksById=JSON.parse(n));var a=window.localStorage.getItem("currentTime");a&&(this.currentTime=JSON.parse(a))}}return Object(x.a)(e,[{key:"tracks",get:function(){return Object.values(this.tracksById)}}]),Object(x.a)(e,[{key:"maxTime",get:function(){return Math.max.apply(Math,Object(S.a)(this.tracks.map((function(e){return e.endTime-e.startTime}))))}}]),e}(),r=Object(M.a)(a.prototype,"tracksById",[F.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),i=Object(M.a)(a.prototype,"currentTime",[F.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c=Object(M.a)(a.prototype,"autoIncrement",[F.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(M.a)(a.prototype,"tracks",[F.g],Object.getOwnPropertyDescriptor(a.prototype,"tracks"),a.prototype),Object(M.a)(a.prototype,"maxTime",[F.g],Object.getOwnPropertyDescriptor(a.prototype,"maxTime"),a.prototype),o=Object(M.a)(a.prototype,"addTrack",[F.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t=Object(k.a)(y.a.mark((function t(n,a){var r;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object(z.a)(),t.next=3,G(n,r,a);case 3:e.tracksById[r]=t.sent;case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}}),l=Object(M.a)(a.prototype,"removeTrack",[F.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){delete e.tracksById[t]}}}),a);window.persist=R.persist,Object(F.o)(R.tracksById,(function(){R.persist()}));setInterval((function(){R.autoIncrement&&(R.currentTime=Math.min(R.currentTime+2500,R.maxTime))}),1e3/24);var $=R,K=Object(p.a)((function(){var e=Object(u.useState)(!1),t=Object(O.a)(e,2),n=t[0],a=t[1],r=Object(w.a)(),i=r.acceptedFiles,c=r.getRootProps,o=r.getInputProps,l=Object(u.useState)(new Set),m=Object(O.a)(l,2),f=m[0],p=m[1],d=function(e){return p((function(t){var n=new Set(t);return n.add(e),n}))};return Object(u.useEffect)((function(){i.forEach(d)}),[n]),s.a.createElement(j.a,{trigger:s.a.createElement(E.a,{primary:!0,content:"Add Tracks",onClick:function(){return a(!0)}}),open:n,onClose:function(){return a(!1)}},s.a.createElement(j.a.Header,null,"Add Track"),s.a.createElement(j.a.Content,null,i.filter((function(e){return!f.has(e)})).map((function(e){return s.a.createElement(g.a,{key:e.name,style:{display:"flex",justifyContent:"space-between"}},e.name,s.a.createElement(E.a,{negative:!0,icon:"trash",onClick:function(){return d(e)}}))})),s.a.createElement("div",c(),s.a.createElement(g.a,null,s.a.createElement("input",o()),s.a.createElement("p",null,"+ Drag 'n' drop some files here, or click to select files +")))),s.a.createElement(j.a.Actions,null,s.a.createElement(E.a,{primary:!0,content:"Add selected tracks",onClick:function(){i.filter((function(e){return!f.has(e)})).forEach(function(){var e=Object(k.a)(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=$,e.next=3,t.text();case 3:return e.t1=e.sent,e.t2=t.name.split(".")[0],e.next=7,e.t0.addTrack.call(e.t0,e.t1,e.t2);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a(!1)}})))})),L=(n(474),n(488)),Q=n(38),U=n(483),X=n(484),Y=n(492),Z=n(115),_=n(116),ee=Object(p.a)((function(e){var t=e.track,n=(e.index,$.getTrackColor(t.id)),a=$.getCurrentPoint(t.id);return s.a.createElement(s.a.Fragment,null,s.a.createElement(U.a,{color:n,positions:t.positions.map((function(e){return[e.latitude,e.longitude]}))}),a&&s.a.createElement(X.a,{center:[a.latitude,a.longitude],color:n,radius:10},s.a.createElement(Y.a,null,s.a.createElement(L.a,null,s.a.createElement(L.a.Item,null,s.a.createElement(Q.a,{name:"heart"}),s.a.createElement(L.a.Content,null,Math.round(a.heartrate))),s.a.createElement(L.a.Item,null,s.a.createElement("i",{className:"icon"},s.a.createElement(Z.a,null)),s.a.createElement(L.a.Content,null,Math.round(a.elevation)," m")),s.a.createElement(L.a.Item,null,s.a.createElement("i",{className:"icon"},s.a.createElement(_.a,null)),s.a.createElement(L.a.Content,null,Math.round(36*a.speed)/10," km/h"))))))})),te=n(485),ne=Object(p.a)((function(e){var t=e.track,n=$.getTrackColor(t.id),a=$.getCurrentPoint(t.id),r=Object(u.useState)(!1),i=Object(O.a)(r,2),c=i[0],o=i[1],l=function(e){return a?e(a):"--"};return s.a.createElement(g.a,{style:{borderTop:"2px solid ".concat(n)}},s.a.createElement("label",{style:{position:"absolute",top:0,left:10,fontSize:".8em",fontWeight:"bold"}},t.name),s.a.createElement(L.a,{horizontal:!0},c?s.a.createElement(L.a.Item,null,s.a.createElement(te.a,{label:"Offset in seconds",labelPosition:"left corner",type:"number",val:"".concat($.tracksById[t.id].timeOffset/1e3),onChange:function(e){$.tracksById[t.id].timeOffset=1e3*+e.target.value}})):s.a.createElement(L.a.Item,null,s.a.createElement(L.a,{horizontal:!0,divided:!0},s.a.createElement(L.a.Item,{style:{width:60,textAlign:"left"}},s.a.createElement(L.a.Content,null,s.a.createElement(Q.a,{name:"heart"}),l((function(e){return Math.round(e.heartrate)})))),s.a.createElement(L.a.Item,{style:{width:80,textAlign:"left"}},s.a.createElement(L.a.Content,null,s.a.createElement("i",{className:"icon"},s.a.createElement(Z.a,null)),l((function(e){return Math.round(e.elevation)}))," m")),s.a.createElement(L.a.Item,{style:{width:100,textAlign:"left"}},s.a.createElement(L.a.Content,null,s.a.createElement("i",{className:"icon"},s.a.createElement(_.a,null)),l((function(e){return Math.round(36*e.speed)/10}))," km/h")))),s.a.createElement(L.a.Item,null,s.a.createElement(E.a,{basic:!c,size:"mini",circular:!0,icon:"setting",onClick:function(){return o((function(e){return!e}))}})),s.a.createElement(L.a.Item,null,s.a.createElement(E.a,{icon:"trash",negative:!0,basic:!0,size:"mini",circular:!0,onClick:function(){return $.removeTrack(t.id)}}))))}));var ae=Object(p.a)((function(){var e=~~($.currentTime/1e3),t=~~(e/60);e%=60;var n=~~(t/60);return t%=60,s.a.createElement("div",{className:"App",style:{display:"flex",justifyContent:"center",alignItems:"center"}},s.a.createElement("div",{style:{position:"absolute",top:0,right:0,zIndex:1e3,maxHeight:"calc(100vw - 100px)",overflow:"auto"}},s.a.createElement(g.a,null,$.tracks.map((function(e){return s.a.createElement(ne,{key:e.id,track:e})})),s.a.createElement(K,null))),$.tracks.length&&s.a.createElement("div",{style:{position:"absolute",bottom:0,right:0,left:0,zIndex:1e3}},s.a.createElement(g.a,{style:{display:"flex",alignItems:"center"}},s.a.createElement(E.a,{onClick:function(){$.autoIncrement=!$.autoIncrement},basic:!0},$.autoIncrement?"Stop":"Play"),s.a.createElement("span",{style:{width:"100px"}},n,":",t,":",e),s.a.createElement("div",{style:{flexGrow:1}},s.a.createElement(b.Slider,{value:$.currentTime,settings:{min:0,max:$.maxTime,step:1,onChange:function(e){Math.abs(e-$.currentTime)>6e4&&($.autoIncrement=!1),$.currentTime=e}}})))),s.a.createElement(d.a,{center:[49.75618698634207,13.303053053095937],zoom:15},s.a.createElement(h.a,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),$.tracks.map((function(e,t){return s.a.createElement(ee,{track:e,index:t})}))))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));f.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(ae,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[284,1,2]]]);
//# sourceMappingURL=main.f993e767.chunk.js.map